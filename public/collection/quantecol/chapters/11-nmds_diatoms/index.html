<!DOCTYPE html>
<html lang="en" dir="ltr"><head>
  
                           
     


<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.96.0" />
<title>11b. nMDS of Mayombo&#39;s diatom data | BCB R Stats Pages</title>


<meta property="twitter:site" content="@ajsmit">
<meta property="twitter:creator" content="@ajsmit">







  
    
  
<meta name="description" content="What you need to know upfront.">


<meta property="og:site_name" content="BCB R Stats Pages">
<meta property="og:title" content="11b. nMDS of Mayombo&#39;s diatom data | BCB R Stats Pages">
<meta property="og:description" content="What you need to know upfront." />
<meta property="og:type" content="page" />
<meta property="og:url" content="/collection/quantecol/chapters/11-nmds_diatoms/" />
<meta property="og:locale" content="en">




    
        <meta property="og:image" content="/img/papillons.jpg" >
        <meta property="twitter:card" content="summary_large_image">
        <meta name="twitter:image" content="/img/papillons.jpg" >
    
  <meta itemprop="name" content="11b. nMDS of Mayombo&#39;s diatom data">
<meta itemprop="description" content="Kelp forests are known to host a large biomass of epiphytic fauna and flora, including diatoms, which constitute the base of aquatic food webs and play an important role in the transfer of energy to higher trophic levels. Epiphytic diatom assemblages associated with two common species of South African kelps, Ecklonia maxima and Laminaria pallida, were investigated in this study. Primary blades of adult and juvenile thalli of both kelp species were sampled at False Bay in July 2017 and analysed using scanning electron microscopy."><meta itemprop="datePublished" content="2021-01-01T00:00:00+00:00" />
<meta itemprop="dateModified" content="2021-01-01T00:00:00+00:00" />
<meta itemprop="wordCount" content="3240">
<meta itemprop="keywords" content="" />
  
  
  <!--[if IE]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/img/favicon.ico" type="image/x-icon">
  
  
  <link rel="stylesheet" href="/style.main.min.13dd27d3efb7ed4ad82be3040182ddbf5ab9d3b4d6d01f0ba3930845932fce66.css" integrity="sha256-E90n0&#43;&#43;37UrYK&#43;MEAYLdv1q507TW0B8Lo5MIRZMvzmY=" media="screen">
  
  
  <script src="/panelset.min.8f4cba0107356728f266d94a12a4d18ef504eda8a9a284cda73675bae7884a68.js" type="text/javascript"></script>
  
  
  <script src="/main.min.318ee9c0652bba0149e7503c97e37e638937f3a9cad9233e6d0ba00bf7a46a5e.js" type="text/javascript"></script>
</head>
<body>
      <div class="grid-container single-series">
<header class="site-header pt4 pb2 mb4 bb b--transparent ph5 headroom z-max" role="banner">
  <nav class="site-nav db dt-l w-100" role="navigation">
    <a class="site-brand db dtc-l v-mid link no-underline w-100 w-33-l tc tl-l" href="/" title="Home">
      <img src="/img/xaringan-outline.png" class="dib db-l h2 w-auto" alt="BCB R Stats Pages">
    </a>
    <div class="site-links db dtc-l v-mid w-100 w-47-l tc tr-l mt3 mt0-l ttu tracked">
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/about/" title="About AJ Smit">About</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/workshops/" title="BCB Hons">BCB Hons</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/project/" title="Project Portfolio">Projects</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 active" href="/collection/" title="R Courses">R Courses</a>
      
      
    </div>
  </nav>
</header>


<main class="page-main ph4 pt4" role="main">
  <section class="page-content mw7 center">
    <article class="post-content pa0 pr3-l">
      <header class="post-header">
        <h4 class="breadcrumb pb5">

  
    
      
  
    
      
  
    
      
  

    
    
      <a href="/collection/">B.Sc. (Hons.) R modules</a>
    
  

    
    
      <a href="/collection/quantecol/">BCB743</a>
    
  

    
    
      11b. nMDS of Mayombo&#39;s diatom data
    
  

</h4>




        
        <h1 class="f1 lh-solid measure-narrow mb3 fw4">11b. nMDS of Mayombo&#39;s diatom data</h1>
        
        <p class="f6 measure lh-copy mv1"></p>
        <p class="f7 db mv0 ttu">January 1, 2021</p>
        
        
      
        
      </header>
      <section class="post-body pt5 pb4">
        


<!-- # Topic 11: nMDS of the diatom data in Mayombo et al. (2019) -->
<p>Kelp forests are known to host a large biomass of epiphytic fauna and flora, including diatoms, which constitute the base of aquatic food webs and play an important role in the transfer of energy to higher trophic levels. Epiphytic diatom assemblages associated with two common species of South African kelps, <em>Ecklonia maxima</em> and <em>Laminaria pallida</em>, were investigated in this study. Primary blades of adult and juvenile thalli of both kelp species were sampled at False Bay in July 2017 and analysed using scanning electron microscopy. The diatom community data are here subjected to a suit of multivariate methods in order to show the structure of the diatom flora as a function of i) kelp species, and ii) kelp size. Read Mayombo et al. (2019) for more details and the findings of the research.</p>
<p>Some feedback was received by anonymous reviewers as part of the peer review process, and it together with my response is repeated below.</p>
<p><strong>Reviewer 1</strong></p>
<p>The design of the observational study includes 2 treatments - age (young versus old) and host species (<em>Laminaria</em> versus <em>Ecklonia</em>), 4 replicates (4 primary blades from each combination of host algae and age), and 3 subsamples from each blade (pseudoreplicates, if treated incorrectly as replicates). The experimental design is analogous to a 2-way ANOVA, but with community data instead of a single individual response variable. This design can evaluate interactive effects between the two treatments (age and species). The authors’ experimental design is most suited to analyses using PERMANOVA, which is the community statistics version of the ANOVA.</p>
<p>Please indicate for the readers why the data were transformed and standardised using the stated procedures. Definitely a good idea to transform data, but the readers need to understand why particular procedures were employed. Please describe the Wisconsin double standardisation (row/column standardised by row/column total – to produce relative abundance to total and column/row standardised by column/row max – to produce abundance relative to species max abundance). Why a double standardisation + square-root transformation, as opposed to a single row/column standardisation by row/column total + square-root transformation?</p>
<p>Please indicate for the readers why the data were transformed and standardised using the stated procedures. Definitely a good idea to transform data, but the readers need to understand why particular procedures were employed. Please describe the Wisconsin double standardisation:</p>
<ul>
<li>row/column standardised by row/column total to produce relative abundance to total and column/row standardised; vs.</li>
<li>column/row max–to produce abundance relative to species max abundance.</li>
</ul>
<p><strong>AJS: About ANOSIM and PERMANOVA</strong></p>
<p>“Overall, Analysis of Similarities (ANOSIM) and the Mantel test were very sensitive to heterogeneity in dispersions, with ANOSIM generally being more sensitive than the Mantel test. In contrast, PERMANOVA and Pillai’s trace were largely unaffected by heterogeneity for balanced designs. […]. PERMANOVA was also unaffected by differences in correlation structure. […] PERMANOVA was generally, but not always, more powerful than the others to detect changes in community structure.”</p>
<p><strong>AJS: About data transformation</strong></p>
<p>Useful when the range of data values is very large. Data are square root transformed, and then submitted to Wisconsin double standardisation, or species divided by their maxima, and stands standardised to equal totals. These two standardisations often improve the quality of ordinations.</p>
<div id="set-up-the-analysis-environment" class="section level2">
<h2>Set-up the analysis environment</h2>
<pre class="r"><code>library(tidyverse)
library(vegan)
library(plyr)
# library(BiodiversityR)</code></pre>
</div>
<div id="load-and-prepare-the-data" class="section level2">
<h2>Load and prepare the data</h2>
<div id="the-species-data" class="section level3">
<h3>The species data</h3>
<p>The diatom species data include the following:</p>
<ul>
<li>columns: diatom genera</li>
<li>rows: samples (samples taken from two species of kelp; equivalent to sites in other species x sites tables)</li>
<li>row names correspond to combinations of the factors in the columns inside <code>PB_diat_env.csv</code></li>
</ul>
<p>where “host_size” is ‘A’ for adult kelp plant (host), ‘J’ for juvenile kelp plant (host), “host_spp” is ‘Lp’ for kelp species <em>Laminaria pallida</em> (host), ‘Em’ for kelp plant <em>Ecklonia maxima</em> (host), “plant” is the unique number identifying a specific kelp plant, and “rep” is the replicate tissue sample from each kelp host plant from which the diatoms were extracted.</p>
<pre class="r"><code># with shortened name to fix nMDS overplotting
spp &lt;- read.csv(file = &quot;/Users/ajsmit/Dropbox/R/workshops/Quantitative_Ecology/exercises/diatoms/PB_data_matrix_abrev.csv&quot;,
                row.names = &quot;Replicate&quot;, sep = &quot;,&quot;, header = TRUE)
spp[1:6, 1:6]</code></pre>
<pre><code>##         Amphora.spp Asteromphalus.spp Cocconeis.spp Craspedostauros.spp
## APB1LP1           0                 0             0                   0
## APB1LP2           0                 0             0                   0
## APB1LP3           0                 0             0                   0
## APB2LP1           0                 0             0                   0
## APB2LP2           0                 0             0                   0
## APB2LP3           0                 0             0                   0
##         Cylindrotheca.spp Diploneis.spp
## APB1LP1                 0             0
## APB1LP2                 0             0
## APB1LP3                 0             0
## APB2LP1                 0             0
## APB2LP2                 0             0
## APB2LP3                 0             0</code></pre>
<pre class="r"><code># with full names
spp2 &lt;- read.csv(file = &quot;/Users/ajsmit/Dropbox/R/workshops/Quantitative_Ecology/exercises/diatoms/PB_data_matrix.csv&quot;,
                 row.names = &quot;Replicate&quot;, sep = &quot;,&quot;, header = TRUE)
spp2[1:6, 1:6]</code></pre>
<pre><code>##         Amphora.spp Asteromphalus.spp Cocconeis.spp Craspedostauros.spp
## APB1LP1           0                 0             0                   0
## APB1LP2           0                 0             0                   0
## APB1LP3           0                 0             0                   0
## APB2LP1           0                 0             0                   0
## APB2LP2           0                 0             0                   0
## APB2LP3           0                 0             0                   0
##         Cylindrotheca.spp Diploneis.spp
## APB1LP1                 0             0
## APB1LP2                 0             0
## APB1LP3                 0             0
## APB2LP1                 0             0
## APB2LP2                 0             0
## APB2LP3                 0             0</code></pre>
<pre class="r"><code># remove &quot;.spp&quot; from column header name
colnames(spp) &lt;- str_replace(colnames(spp), &quot;\\.spp&quot;, &quot;&quot;)
colnames(spp2) &lt;- str_replace(colnames(spp2), &quot;\\.spp&quot;, &quot;&quot;)</code></pre>
<p>Logarithmic transformation as suggested by Anderson et al. (2006): <span class="math inline">\(log_{b}(x) + 1\)</span> for <span class="math inline">\(x &gt; 0\)</span>, where <span class="math inline">\(b\)</span> is the base of the logarithm; zeros are left as zeros. Higher bases give less weight to quantities and more to presences.</p>
<pre class="r"><code>spp.log &lt;- decostand(spp, method = &quot;log&quot;)
spp.log.dis &lt;- vegdist(spp.log, method = &quot;bray&quot;)</code></pre>
</div>
<div id="the-environmental-data" class="section level3">
<h3>The ‘environmental’ data</h3>
<p>The content is described above; these variables are categorical vars – they are not actually ‘environmental’ data, but their purpose in the analysis is analogous to true environmental data; it’s simply data that describe where the samples were taken from.</p>
<pre class="r"><code>env &lt;- tibble(read.csv(file = &quot;/Users/ajsmit/Dropbox/R/workshops/Quantitative_Ecology/exercises/diatoms/PB_diat_env.csv&quot;,
                          sep = &quot;,&quot;, header = TRUE))
env$plant &lt;- as.factor(env$plant)
env$rep &lt;- as.factor(env$rep)
head(env)</code></pre>
<pre><code>## # A tibble: 6 × 5
##   replicate host_size host_spp plant rep  
##   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    &lt;fct&gt; &lt;fct&gt;
## 1 APB1LP1   A         Lp       1     1    
## 2 APB1LP2   A         Lp       1     2    
## 3 APB1LP3   A         Lp       1     3    
## 4 APB2LP1   A         Lp       2     1    
## 5 APB2LP2   A         Lp       2     2    
## 6 APB2LP3   A         Lp       2     3</code></pre>
<p>With the environmental data (factors), the following analyses can be done:</p>
<ul>
<li>✘ Discriminant Analysis (DA)</li>
<li>✘ Analysis of Similarities (ANOSIM)</li>
<li>✔︎ Permutational Analysis of Variance (PERMANOVA)</li>
<li>✘ Mantel test</li>
</ul>
<p>We will do an nMDS and PERMANOVA.</p>
</div>
</div>
<div id="multivariate-homogeneity-of-group-dispersions-variances" class="section level2">
<h2>Multivariate homogeneity of group dispersions (variances)</h2>
<p>Before doing the PERMANOVA (testing differences between means), first check to see if the dispersion is the same. See <code>?adonis2</code> for more on this.</p>
<p><strong>Homogeneity of groups</strong> <code>betadisper()</code> evaluates the differences in group homogeneities. We can view it as being analogous to Levene’s test of the equality of variances. The null hypothesis evaluated is that the population variances are equal. Unfortunately we can only use one factor as an independent variable so it is not yet possible to look for interactions (species × size).</p>
<p>So, we test the <span class="math inline">\(H_{0}\)</span> that the dispersion (variance) in diatom community structure does not differ between the two host species:</p>
<pre class="r"><code>(mod.spp &lt;- with(env, betadisper(spp.log.dis, host_spp)))</code></pre>
<pre><code>## 
##  Homogeneity of multivariate dispersions
## 
## Call: betadisper(d = spp.log.dis, group = host_spp)
## 
## No. of Positive Eigenvalues: 20
## No. of Negative Eigenvalues: 21
## 
## Average distance to median:
##     Em     Lp 
## 0.3640 0.4391 
## 
## Eigenvalues for PCoA axes:
## (Showing 8 of 41 eigenvalues)
##  PCoA1  PCoA2  PCoA3  PCoA4  PCoA5  PCoA6  PCoA7  PCoA8 
## 1.9619 1.7968 1.3888 1.0040 0.8491 0.6366 0.3132 0.3008</code></pre>
<pre class="r"><code>anova(mod.spp)</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Response: Distances
##           Df  Sum Sq  Mean Sq F value Pr(&gt;F)
## Groups     1 0.05876 0.058761  2.6087 0.1141
## Residuals 40 0.90101 0.022525</code></pre>
<p>There is no difference in dispersion between the diatom communities on the two host species. Apply the same procedure to see if host size has an effect:</p>
<pre class="r"><code>(mod.size &lt;- with(env, betadisper(spp.log.dis, host_size)))</code></pre>
<pre><code>## 
##  Homogeneity of multivariate dispersions
## 
## Call: betadisper(d = spp.log.dis, group = host_size)
## 
## No. of Positive Eigenvalues: 20
## No. of Negative Eigenvalues: 21
## 
## Average distance to median:
##      A      J 
## 0.4005 0.3889 
## 
## Eigenvalues for PCoA axes:
## (Showing 8 of 41 eigenvalues)
##  PCoA1  PCoA2  PCoA3  PCoA4  PCoA5  PCoA6  PCoA7  PCoA8 
## 1.9619 1.7968 1.3888 1.0040 0.8491 0.6366 0.3132 0.3008</code></pre>
<pre class="r"><code>anova(mod.size)</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Response: Distances
##           Df  Sum Sq   Mean Sq F value Pr(&gt;F)
## Groups     1 0.00141 0.0014134  0.0604 0.8071
## Residuals 40 0.93615 0.0234038</code></pre>
<p>No, it does not have an effect either. Make some plots to visualise the pstterrns:</p>
<pre class="r"><code>par(mfrow = c(2, 2))
plot(mod.spp, sub = NULL)
boxplot(mod.spp)

plot(mod.size)
boxplot(mod.size)</code></pre>
<p><img src="/collection/quantecol/chapters/11-nMDS_diatoms_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Optionally, we can confirm the above analysis with the <code>permutest()</code> function. <code>permutest()</code> is a permutational ANOVA-like test that tests the <span class="math inline">\(H_{0}\)</span> that there is no difference in the multivariate dispersion of diatom community structure between <em>Ecklonia maxima</em> and <em>Laminaria pallida</em>, and between adult and juvenile plants:</p>
<pre class="r"><code>permutest(mod.spp) # there is in fact no difference</code></pre>
<pre><code>## 
## Permutation test for homogeneity of multivariate dispersions
## Permutation: free
## Number of permutations: 999
## 
## Response: Distances
##           Df  Sum Sq  Mean Sq      F N.Perm Pr(&gt;F)
## Groups     1 0.05876 0.058761 2.6087    999  0.111
## Residuals 40 0.90101 0.022525</code></pre>
<pre class="r"><code>permutest(mod.size) # nope...</code></pre>
<pre><code>## 
## Permutation test for homogeneity of multivariate dispersions
## Permutation: free
## Number of permutations: 999
## 
## Response: Distances
##           Df  Sum Sq   Mean Sq      F N.Perm Pr(&gt;F)
## Groups     1 0.00141 0.0014134 0.0604    999  0.826
## Residuals 40 0.93615 0.0234038</code></pre>
<p>It should be sufficient to do the <code>anova()</code>, above, though. You can safely ignore the <code>permutest()</code>.</p>
</div>
<div id="permanova" class="section level2">
<h2>PERMANOVA</h2>
<p>Permutational multivariate Analysis of Variance (PERMANOVA; Anderson and Walsh, 2013) uses distance matrices (Bray-Curtis similarities by default), whereas ANOSIM uses only ranks of Bray-Curtis. The former therefore preserves more information and it is the recommended approach to test for differences between multivariate means. PERMANOVA also allows for variation partitioning and permits for more complex designs (multiple factors, nested factors, interactions, covariates, etc.). To this end, we use <code>adonis2()</code> to evaluate the differences in the group means, which makes it analogous to multivariate analysis of variance.</p>
<p>Note that nestedness should be stated in the blocks (plants): “If you have a nested error structure, so that you do not want your data be shuffled over classes (blocks), you should define blocks in your permutation” – Jari Oksannen</p>
<pre class="r"><code># the permutational structure captures the nesting of replicates within plant
perm &lt;- how(nperm = 1000)
setBlocks(perm) &lt;- with(env, plant)

(perm.1 &lt;- adonis2(spp.log.dis ~ host_spp * host_size,
                   method = p, data = env,
                   permutations = perm))</code></pre>
<pre><code>## Permutation test for adonis under reduced model
## Terms added sequentially (first to last)
## Blocks:  with(env, plant) 
## Permutation: free
## Number of permutations: 1000
## 
## adonis2(formula = spp.log.dis ~ host_spp * host_size, data = env, permutations = perm, method = p)
##                    Df SumOfSqs      R2      F Pr(&gt;F)
## host_spp            1   0.2991 0.03815 1.7234      1
## host_size           1   0.3726 0.04754 2.1475      1
## host_spp:host_size  1   0.5727 0.07306 3.3003      1
## Residual           38   6.5938 0.84124              
## Total              41   7.8381 1.00000</code></pre>
<p>There is no effect resulting from host species, host size, or interactions between the two.</p>
</div>
<div id="nmds" class="section level2">
<h2>nMDS</h2>
<p>Do the nMDS and assemble the figures:</p>
<pre class="r"><code>spp.nmds &lt;- metaMDS(spp.log, k = 2,trymax = 100,
                    distance = &quot;bray&quot;, wascores = TRUE)</code></pre>
<pre><code>## Run 0 stress 0.1916291 
## Run 1 stress 0.2042719 
## Run 2 stress 0.191629 
## ... New best solution
## ... Procrustes: rmse 0.001254313  max resid 0.00622263 
## ... Similar to previous best
## Run 3 stress 0.1893038 
## ... New best solution
## ... Procrustes: rmse 0.07589473  max resid 0.2142477 
## Run 4 stress 0.1925559 
## Run 5 stress 0.1893036 
## ... New best solution
## ... Procrustes: rmse 0.0003498488  max resid 0.001971929 
## ... Similar to previous best
## Run 6 stress 0.1893036 
## ... Procrustes: rmse 8.925139e-05  max resid 0.0004965947 
## ... Similar to previous best
## Run 7 stress 0.1909532 
## Run 8 stress 0.1974733 
## Run 9 stress 0.1906808 
## Run 10 stress 0.1937168 
## Run 11 stress 0.1909532 
## Run 12 stress 0.1925562 
## Run 13 stress 0.2030249 
## Run 14 stress 0.1981307 
## Run 15 stress 0.1909532 
## Run 16 stress 0.1893036 
## ... New best solution
## ... Procrustes: rmse 5.154713e-05  max resid 0.0002685985 
## ... Similar to previous best
## Run 17 stress 0.1925561 
## Run 18 stress 0.1891593 
## ... New best solution
## ... Procrustes: rmse 0.1041845  max resid 0.4050062 
## Run 19 stress 0.2000868 
## Run 20 stress 0.1909532 
## Run 21 stress 0.1909532 
## Run 22 stress 0.1906802 
## Run 23 stress 0.1893036 
## ... Procrustes: rmse 0.1041856  max resid 0.4071242 
## Run 24 stress 0.1898317 
## Run 25 stress 0.2319559 
## Run 26 stress 0.1909532 
## Run 27 stress 0.1909532 
## Run 28 stress 0.1910973 
## Run 29 stress 0.2209779 
## Run 30 stress 0.1891595 
## ... Procrustes: rmse 0.0001855426  max resid 0.0009752994 
## ... Similar to previous best
## *** Solution reached</code></pre>
<pre class="r"><code># not printed as it is too long...
# scores(spp.nmds, display = &quot;species&quot;)
# scores(spp.nmds, display = &quot;sites&quot;)</code></pre>
<pre class="r"><code>col &lt;- c(&quot;indianred3&quot;, &quot;steelblue4&quot;)
pch &lt;- c(17, 19)
opar &lt;- par()
plt1 &lt;- layout(rbind(c(1, 1, 2, 2, 3, 3),
                     c(4, 4, 4, 5, 5, 5)),
               heights = c(2, 3),
               respect = TRUE)

# layout.show(plt1)

par(mar = c(3,3,1,1))

# plot 1
plot(mod.spp, main = NULL,
     tck = .05, mgp = c(1.8, 0.5, 0), col = col, pch = pch,
     sub = NULL)

# plot 2
plot(mod.size, main = NULL,
     tck = .05, mgp = c(1.8, 0.5, 0), col = col, pch = pch,
     sub = NULL)

# plot 3
stressplot(spp.nmds, p.col = &quot;steelblue4&quot;, l.col = &quot;indianred3&quot;,
           tck = .05, mgp = c(1.8, 0.5, 0))

# plot 4
par(mar = c(3,3,2,1))
plot(spp.nmds, display = &quot;sites&quot;, type = &quot;n&quot;,
     main = NULL,
     tck = .05, mgp = c(1.8, 0.5, 0),
     xlim = c(-2, 2), ylim = c(-1, 2))
with(env,
     points(spp.nmds, display = &quot;sites&quot;, col = col[host_spp],
            pch = pch[host_spp]))
with(env,
     ordispider(spp.nmds, groups = host_spp,
                label = TRUE,
                col = col))
with(env, ordiellipse(spp.nmds, groups = host_spp,
                      col = col, label = FALSE))
points(spp.nmds, display = &quot;species&quot;, pch = 1, col = &quot;seagreen&quot;)
orditorp(spp.nmds, display = &quot;species&quot;, cex = 0.8,
         col = &quot;black&quot;, air = 0.01)

# plot 5
par(mar = c(3, 3, 2, 1))
plot(spp.nmds, display = &quot;sites&quot;, type = &quot;n&quot;,
     main = NULL,
     tck = .05, mgp = c(1.8, 0.5, 0),
     xlim = c(-2, 2), ylim = c(-1, 2))
with(env,
     points(spp.nmds, display = &quot;sites&quot;, col = col[host_size],
            pch = pch[host_size]))
with(env,
     ordispider(spp.nmds, groups = host_size,
                label = TRUE,
                col = col))
with(env, ordiellipse(spp.nmds, groups = host_size,
                      col = col, label = FALSE))
points(spp.nmds, display = &quot;species&quot;, pch = 1, col = &quot;seagreen&quot;)
orditorp(spp.nmds, display = &quot;species&quot;, cex = 0.8,
         col = &quot;black&quot;, air = 0.01)</code></pre>
<p><img src="/collection/quantecol/chapters/11-nMDS_diatoms_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<pre class="r"><code># dev.off()
par(opar)</code></pre>
</div>
<div id="multivariate-abundance-using-generalised-linear-models" class="section level2">
<h2>Multivariate abundance using Generalised Linear Models</h2>
<p>I’ll not discuss this method here, but merely repeat the code as used in the Mayombo et al. (2019) paper. For background to the Multivariate abundance using Generalised Linear Models approach, refer to Wang et al. (2012, 2018).</p>
<pre class="r"><code>library(mvabund)
diat_spp &lt;- mvabund(spp2)</code></pre>
<p>Look at the spread of the data using the boxplot function. The figure is not used in paper:</p>
<pre class="r"><code>par(mar = c(2, 10, 2, 2)) # adjusts the margins
boxplot(spp, horizontal = TRUE, las = 2, main = &quot;Abundance&quot;)</code></pre>
<p><img src="/collection/quantecol/chapters/11-nMDS_diatoms_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Check the mean-variance relationship:</p>
<pre class="r"><code>meanvar.plot(diat_spp)</code></pre>
<p><img src="/collection/quantecol/chapters/11-nMDS_diatoms_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>The above plot shows that spp with a high mean also have a high variance.</p>
<ol style="list-style-type: decimal">
<li>Are there differences in the species composition of the diatom spp. sampled? <em>This has already been addressed above, but we can apply an lternative approach below</em>.</li>
<li>Do some of them specialise on particular spp of kelp, while others are more generalised? <em>Addressed below</em>.</li>
<li>Do some occur more on juveniles, while some are on adults, and which ones indiscriminately live across age classes? <em>Addressed below</em>.</li>
<li>Which species? <em>Addressed below</em>.</li>
</ol>
<p>Scale manually for <code>ggplot2()</code> custom plot. Create a scale function:</p>
<pre class="r"><code>log_fun &lt;- function(x) {
  min_x &lt;- min(x[x != 0], na.rm = TRUE)
  a &lt;- log(x) / min_x
  a[which(!is.finite(a))] &lt;- 0
  return(a)
}</code></pre>
<p>Make a plot that shows which diatoms species are responsible for differences between adult and juvenile kelps:</p>
<pre class="r"><code>spp2 %&gt;%
  mutate(host_size = env$host_size) %&gt;%
  gather(key = species, value = abund, -host_size) %&gt;%
  as_tibble() %&gt;%
  group_by(species) %&gt;%
  mutate(log.abund = log_fun(abund)) %&gt;%
  ungroup() %&gt;%
  ggplot(aes(x = fct_reorder(species, abund, .fun = mean), y = log.abund)) +
  geom_boxplot(aes(colour = host_size), size = 0.4, outlier.size = 0,
               fill = &quot;grey90&quot;) +
  geom_point(aes(colour = host_size, shape = host_size),
             position = position_dodge2(width = 0.8),
             alpha = 0.6, size = 2.5) +
  scale_colour_manual(name = &quot;Age&quot;, values = c(&quot;indianred3&quot;, &quot;steelblue4&quot;)) +
  scale_shape_manual(name = &quot;Age&quot;, values = c(17, 19)) +
  annotate(&quot;text&quot;, x = 15, y = 3, size = 4.5,
           label = expression(paste(italic(&quot;p&quot;), &quot;=0.017&quot;))) +
  annotate(&quot;text&quot;, x = 14, y = 3, size = 4.5,
           label = expression(paste(italic(&quot;p&quot;), &quot;=0.004&quot;))) +
  scale_y_continuous(name = &quot;Log abundance&quot;) +
  coord_flip() + theme_bw() +
  theme(panel.grid.major = element_line(linetype = &quot;dashed&quot;,
                                        colour = &quot;seagreen3&quot;, size = 0.2),
        panel.grid.minor = element_blank(),
        axis.text.x = element_text(size = 13, color = &quot;black&quot;,
                                   margin = unit(c(0.5, 0.5, 0.5, 0.5), &quot;cm&quot;)),
        axis.text.y = element_text(size = 13, color = &quot;black&quot;, face = &quot;italic&quot;,
                                   margin = unit(c(0.5, 0.5, 0.5, 0.5), &quot;cm&quot;)),
        axis.title.x = element_text(size = 14, vjust = 5.75, color = &quot;black&quot;),
        axis.title.y = element_blank(),
        axis.ticks.length = unit(-0.25, &quot;cm&quot;),
        axis.ticks = element_line(color = &quot;black&quot;, size = 0.5))</code></pre>
<pre><code>## Warning in is.na(x): is.na() applied to non-(list or vector) of type
## &#39;expression&#39;

## Warning in is.na(x): is.na() applied to non-(list or vector) of type
## &#39;expression&#39;</code></pre>
<p><img src="/collection/quantecol/chapters/11-nMDS_diatoms_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>I settle on a negative binomial distribution for the species data. This will be provided to the <code>manyglm()</code> function:</p>
<pre class="r"><code>size_mod2 &lt;- manyglm(diat_spp ~ (env$host_spp * env$host_size) / env$plant,
                     family = &quot;negative binomial&quot;)
plot(size_mod2) # better residuals...</code></pre>
<p><img src="/collection/quantecol/chapters/11-nMDS_diatoms_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<pre class="r"><code># anova(size_mod2, test = &quot;wald&quot;)
out &lt;- anova(size_mod2, p.uni = &quot;adjusted&quot;, test = &quot;wald&quot;)</code></pre>
<pre><code>## Time elapsed: 0 hr 0 min 15 sec</code></pre>
<pre class="r"><code>out$table</code></pre>
<pre><code>##                                      Res.Df Df.diff     wald Pr(&gt;wald)
## (Intercept)                              41      NA       NA        NA
## env$host_spp                             40       1 5.227772     0.296
## env$host_size                            39       1 7.799205     0.003
## env$host_spp:env$host_size               38       1 5.434128     0.011
## env$host_spp:env$host_size:env$plant     26      16      NaN     0.001</code></pre>
<p>What is the proportional contribution of some important species to juvenile and adult plants?</p>
<pre class="r"><code>prop.contrib &lt;- data.frame(spp = colnames(out$uni.test),
                           prop = out$uni.test[3, ],
                           row.names = NULL)
prop.contrib %&gt;%
  mutate(perc = round((prop / sum(prop)) * 100, 1)) %&gt;%
  arrange(desc(perc)) %&gt;%
  mutate(cum = cumsum(perc))</code></pre>
<pre><code>##                spp       prop perc   cum
## 1    Rhoicosphenia 4.05979831 16.7  16.7
## 2         Navicula 3.65789127 15.1  31.8
## 3        Nitzschia 2.65842186 10.9  42.7
## 4          Amphora 2.39874550  9.9  52.6
## 5        Cocconeis 2.10936669  8.7  61.3
## 6         Nagumoea 1.92435482  7.9  69.2
## 7   Gomphoseptatum 1.86301773  7.7  76.9
## 8    Cylindrotheca 1.79282759  7.4  84.3
## 9      Parlibellus 1.40898477  5.8  90.1
## 10      Licmophora 0.83203299  3.4  93.5
## 11       Tabularia 0.64240853  2.6  96.1
## 12 Craspedostauros 0.40412954  1.7  97.8
## 13   Grammatophora 0.14035115  0.6  98.4
## 14   Thalassionema 0.09310783  0.4  98.8
## 15   Asteromphalus 0.08434341  0.3  99.1
## 16       Diploneis 0.07915274  0.3  99.4
## 17          Haslea 0.07915274  0.3  99.7
## 18      Trachyneis 0.07149347  0.3 100.0</code></pre>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>Anderson MJ, and Walsh DCI (2013). PERMANOVA, ANOSIM, and the Mantel test in the face of heterogeneous dispersions: What null hypothesis are you testing? Ecological Monographs, 83(4), 557–574. <a href="http://doi.org/10.1890/12-2010.1" class="uri">http://doi.org/10.1890/12-2010.1</a></p>
<p>Mayombo NAS, Majewska R, and Smit AJ (2019). African Journal of Marine Science 2019, 41(2): 221–229</p>
<p>Wang Y, Naumann U, Wright ST, and Warton DI (2012). mvabund – an R package for model-based analysis of multivariate abundance data. Methods in Ecology and Evolution 3: 471–474.</p>
<p>Wang Y, Naumann U, Eddelbuettel D, and Warton DI (2018). mvabund: statistical methods for analysing multivariate abundance data. R package version 3.13.1.</p>
</div>

      </section>
      <footer class="post-footer">
        <div class="post-pagination dt w-100 mt4 mb2">
  
  
    <a class="prev dtc pr2 tl v-top fw6"
    href="/collection/quantecol/chapters/11-nmds/">&larr; 11a. non-Metric multidimensional scaling (nMDS)</a>
  
  
  
    <a class="next dtc pl2 tr v-top fw6"
    href="/collection/quantecol/chapters/12-constrained_ordination/">12. Constrained Ordination &rarr;</a>
  
</div>

      </footer>
    </article>
    
  </section>
</main>

<aside class="page-sidebar" role="complementary">
                         
 











  <img src="/collection/featured-sidebar.jpg" class="db ma0">

                         
 



<div class="flex items-start sticky ph4 pb4 flex-row">
  <div class="w-two-thirds w-50-l ph0">
    <h2 class="mv3 f5 fw7 ttu tracked">
      <a class="no-underline dim" href="/collection/">Outline</a></h2>
    <nav id="SectionTableOfContents" aria-label="SectionTableOfContents">
        <ul>
        
          
          
          
          <details  class="">
            <summary class="" hugo-nav="/collection/intro_r/"><a href="/collection/intro_r/">BCB744 (Intro R)</a></summary>
            
              
              <li class="" hugo-nav="/collection/intro_r/chapters/02-rstudio/"><a href="/collection/intro_r/chapters/02-rstudio/">1. RStudio and R</a></li>
            
              
              <li class="" hugo-nav="/collection/intro_r/chapters/03-github/"><a href="/collection/intro_r/chapters/03-github/">2. GitHub</a></li>
            
              
              <li class="" hugo-nav="/collection/intro_r/chapters/04-workflow/"><a href="/collection/intro_r/chapters/04-workflow/">3. An R workflow</a></li>
            
              
              <li class="" hugo-nav="/collection/intro_r/chapters/05-graphics/"><a href="/collection/intro_r/chapters/05-graphics/">4. Graphics with ggplot2</a></li>
            
              
              <li class="" hugo-nav="/collection/intro_r/chapters/06-faceting/"><a href="/collection/intro_r/chapters/06-faceting/">5. Faceting figures</a></li>
            
              
              <li class="" hugo-nav="/collection/intro_r/chapters/07-brewing/"><a href="/collection/intro_r/chapters/07-brewing/">6. Brewing colours</a></li>
            
              
              <li class="" hugo-nav="/collection/intro_r/chapters/08-mapping/"><a href="/collection/intro_r/chapters/08-mapping/">7. Mapping with ggplot2</a></li>
            
              
              <li class="" hugo-nav="/collection/intro_r/chapters/09-mapping_style/"><a href="/collection/intro_r/chapters/09-mapping_style/">8. Mapping with style</a></li>
            
              
              <li class="" hugo-nav="/collection/intro_r/chapters/10-mapping_openstreetmap/"><a href="/collection/intro_r/chapters/10-mapping_openstreetmap/">9. Mapping with OpenStreetMap</a></li>
            
              
              <li class="" hugo-nav="/collection/intro_r/chapters/11-tidy/"><a href="/collection/intro_r/chapters/11-tidy/">10. Tidy data</a></li>
            
              
              <li class="" hugo-nav="/collection/intro_r/chapters/12-tidier/"><a href="/collection/intro_r/chapters/12-tidier/">11. Tidier data</a></li>
            
              
              <li class="" hugo-nav="/collection/intro_r/chapters/13-tidiest/"><a href="/collection/intro_r/chapters/13-tidiest/">12. Tidiest data</a></li>
            
              
              <li class="" hugo-nav="/collection/intro_r/chapters/14-recap/"><a href="/collection/intro_r/chapters/14-recap/">13. Recap</a></li>
            
              
              <li class="" hugo-nav="/collection/intro_r/chapters/15-functions/"><a href="/collection/intro_r/chapters/15-functions/">14. Functions by chapter</a></li>
            
              
              <li class="" hugo-nav="/collection/intro_r/chapters/16-base_r/"><a href="/collection/intro_r/chapters/16-base_r/">15. Base R primer</a></li>
            
              
              <li class="" hugo-nav="/collection/intro_r/chapters/17-dates/"><a href="/collection/intro_r/chapters/17-dates/">16. Dates</a></li>
            
          </details>
          
          </li>
        
          
          
          
          <details  class="">
            <summary class="" hugo-nav="/collection/biostats/"><a href="/collection/biostats/">BCB744 (Biostats)</a></summary>
            
              
              <li class="" hugo-nav="/collection/biostats/chapters/02-data/"><a href="/collection/biostats/chapters/02-data/">1. Types of data</a></li>
            
              
              <li class="" hugo-nav="/collection/biostats/chapters/03-descriptive/"><a href="/collection/biostats/chapters/03-descriptive/">2. Central tendency and dispersion</a></li>
            
              
              <li class="" hugo-nav="/collection/biostats/chapters/04-graphics/"><a href="/collection/biostats/chapters/04-graphics/">3. Graphical data displays</a></li>
            
              
              <li class="" hugo-nav="/collection/biostats/chapters/06-t_tests/"><a href="/collection/biostats/chapters/06-t_tests/">5. Inferences about one or two populations</a></li>
            
              
              <li class="" hugo-nav="/collection/biostats/chapters/07-anova/"><a href="/collection/biostats/chapters/07-anova/">6. Analysis of Variance (ANOVA)</a></li>
            
              
              <li class="" hugo-nav="/collection/biostats/chapters/08-regressions/"><a href="/collection/biostats/chapters/08-regressions/">7. Simple linear regressions</a></li>
            
              
              <li class="" hugo-nav="/collection/biostats/chapters/09-correlations/"><a href="/collection/biostats/chapters/09-correlations/">8. Correlation</a></li>
            
              
              <li class="" hugo-nav="/collection/biostats/chapters/10-confidence/"><a href="/collection/biostats/chapters/10-confidence/">9. Confidence intervals</a></li>
            
              
              <li class="" hugo-nav="/collection/biostats/chapters/11-transformations/"><a href="/collection/biostats/chapters/11-transformations/">10. Data transformations</a></li>
            
          </details>
          
          </li>
        
          
          
          
          <details open class="active">
            <summary class="active" hugo-nav="/collection/quantecol/"><a href="/collection/quantecol/">BCB743</a></summary>
            
              
              <li class="" hugo-nav="/collection/quantecol/chapters/01-data/"><a href="/collection/quantecol/chapters/01-data/">1. Multivariate data</a></li>
            
              
              <li class="" hugo-nav="/collection/quantecol/chapters/02-biodiversity/"><a href="/collection/quantecol/chapters/02-biodiversity/">2. Biodiversity</a></li>
            
              
              <li class="" hugo-nav="/collection/quantecol/chapters/03-deep_dive/"><a href="/collection/quantecol/chapters/03-deep_dive/">3. Deep Dive into Gradients</a></li>
            
              
              <li class="" hugo-nav="/collection/quantecol/chapters/04-env_dist/"><a href="/collection/quantecol/chapters/04-env_dist/">4. Environmental Distance</a></li>
            
              
              <li class="" hugo-nav="/collection/quantecol/chapters/05-spp_dissimilarity/"><a href="/collection/quantecol/chapters/05-spp_dissimilarity/">5. Species Dissimilarities</a></li>
            
              
              <li class="" hugo-nav="/collection/quantecol/chapters/06-correlations/"><a href="/collection/quantecol/chapters/06-correlations/">6. Correlations and Associations</a></li>
            
              
              <li class="" hugo-nav="/collection/quantecol/chapters/08_pca/"><a href="/collection/quantecol/chapters/08_pca/">8a. Principal Component Analysis (PCA)</a></li>
            
              
              <li class="" hugo-nav="/collection/quantecol/chapters/08-pca_sdg/"><a href="/collection/quantecol/chapters/08-pca_sdg/">8b. PCA of WHO SDGs</a></li>
            
              
              <li class="" hugo-nav="/collection/quantecol/chapters/09-ca/"><a href="/collection/quantecol/chapters/09-ca/">9. Correspondence Analysis (CA)</a></li>
            
              
              <li class="" hugo-nav="/collection/quantecol/chapters/10-pcoa/"><a href="/collection/quantecol/chapters/10-pcoa/">10. Principal Coordinate Analysis (PCoA)</a></li>
            
              
              <li class="" hugo-nav="/collection/quantecol/chapters/11-nmds/"><a href="/collection/quantecol/chapters/11-nmds/">11a. non-Metric multidimensional scaling (nMDS)</a></li>
            
              
              <li class="active" hugo-nav="/collection/quantecol/chapters/11-nmds_diatoms/"><a href="/collection/quantecol/chapters/11-nmds_diatoms/">11b. nMDS of Mayombo&#39;s diatom data</a></li>
            
              
              <li class="" hugo-nav="/collection/quantecol/chapters/12-constrained_ordination/"><a href="/collection/quantecol/chapters/12-constrained_ordination/">12. Constrained Ordination</a></li>
            
              
              <li class="" hugo-nav="/collection/quantecol/chapters/13-cluster_analysis/"><a href="/collection/quantecol/chapters/13-cluster_analysis/">13. Cluster analysis</a></li>
            
          </details>
          
          </li>
        
        </ul>
    </nav>
  </div>
  <details id="PageTableOfContents">
    <summary><h2 class="mv0 f5 fw7 ttu tracked dib">On this page<h2></summary>
    <div class="pl2 pr0 mh0">
    
    </div>
  </details>
  
</div>

</aside>

<footer class="site-footer pv4 bt b--transparent ph5" role="contentinfo">
  <nav class="db dt-l w-100">
    <p class="site-copyright f7 db dtc-l v-mid w-100 w-33-l tc tl-l pv2 pv0-l mv0 lh-copy">
      &copy; 2022 University of the Western Cape, Cape Town
      <span class="middot-divider"></span>
      Made with <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/hugo-apero/" rel="dct:source">Hugo Apéro</a></span>.
      <br />
      
Based on <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/formspree/blogophonic-hugo" rel="dct:source">Blogophonic</a></span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://formspree.io" property="cc:attributionName" rel="cc:attributionURL">Formspree</a>.
    </p>
    
    <div class="site-social-links db dtc-l v-mid w-100 w-33-l tc pv2 pv0-l mv0">
      <div class="social-icon-links" aria-hidden="true">
  
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://github.com/ajsmit/" title="github" target="_blank" rel="noopener">
      <i class="fab fa-github fa-lg fa-fw"></i>
    </a>
  
    
    
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="http://orcid.org/0000-0002-3799-6126" title="orcid" target="_blank" rel="noopener">
      <i class="ai ai-orcid fa-lg fa-fw"></i>
    </a>
  
    
    
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.researchgate.net/profile/Albertus-Smit" title="researchgate" target="_blank" rel="noopener">
      <i class="ai ai-researchgate fa-lg fa-fw"></i>
    </a>
  
    
    
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://uwc.academia.edu/AlbertusSmit" title="academia" target="_blank" rel="noopener">
      <i class="ai ai-academia fa-lg fa-fw"></i>
    </a>
  
    
    
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://scholar.google.co.za/citations?user=ATsBBKoAAAAJ&amp;hl=en" title="google-scholar" target="_blank" rel="noopener">
      <i class="ai ai-google-scholar fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.instagram.com/ajsmit/" title="instagram" target="_blank" rel="noopener">
      <i class="fab fa-instagram fa-lg fa-fw"></i>
    </a>
  
</div>

    </div>
    
    <div class="site-links f6 db dtc-l v-mid w-100 w-67-l tc tr-l pv2 pv0-l mv0">
      
      <a class="dib pv1 ph2 link" href="/license/" title="License">License</a>
      
      <a class="dib pv1 ph2 link" href="/contact/" title="Contact form">Contact</a>
      
      <a class="dib pv1 ph2 link" href="/contributors/" title="Contributors">Contributors</a>
      
    </div>
  </nav>
  
    <script>

    var i, text, code, codes = document.getElementsByTagName('code');
    for (let i = 0; i < codes.length;) {
      code = codes[i];
      if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
        text = code.textContent;
        if (/^\$[^$]/.test(text) && /[^$]\$$/.test(text)) {
          text = text.replace(/^\$/, '\\(').replace(/\$$/, '\\)');
          code.textContent = text;
        }
        if (/^\\\((.|\s)+\\\)$/.test(text) ||
            /^\\\[(.|\s)+\\\]$/.test(text) ||
            /^\$(.|\s)+\$$/.test(text) ||
            /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
          code.outerHTML = code.innerHTML;  
          continue;
        }
      }
      i++;
    }
</script>

  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>



    
  
  
</footer>

      </div>
    </body>
</html>
